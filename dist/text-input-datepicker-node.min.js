export class Datepicker extends HTMLElement{constructor(){super(),this.dayNames=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],this.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.sundayFirst=!1,this.persistOnSelect=!1,this.i=500,this.t=150,this.initDate=null,this.ignoreOnFocus=!1,this.s=!1,this.l=!1,this.h=[],this.v=[],this.o='<style>#calContainer{border:1px solid black;position:absolute;background-color:white;}#calHeader{display:flex;align-items:center;justify-content:space-around;}#calGrid{display:grid;grid-template-columns:auto auto auto auto auto auto auto;padding:10px;width:400px;}.calDayName, .calDayStyle{padding:10px;font-size:20px;text-align:center;}.calDayStyle:hover, .calCtrl:hover{color:white;background-color:black;cursor:default;}.calHiddenRow{display:none;}.calAdjacentMonthDay{color:lightgray;padding:10px;font-size:20px;text-align:center;}.calSelectedDay{color:red;font-weight:bold;}#calTitle{font-size:20px;text-align:center;width:110px;}.calCtrl{display:inline;font-size:35px;user-select:none;padding:0px 8px;}</style><div id="calContainer" tabindex="0"><div id="calHeader"><div id="calCtrlPrevYear" class="calCtrl">&#9668;&#9668;</div><div id="calCtrlPrevMonth" class="calCtrl">&#9668;</div><div id="calTitle"></div><div id="calCtrlNextMonth" class="calCtrl">&#9658;</div><div id="calCtrlNextYear" class="calCtrl">&#9658;&#9658;</div><div id="calCtrlHideCal" class="calCtrl">&#10005;</div></div><div id="calGrid"><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDayName"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div><div class="calDay"></div></div></div>'}static get observedAttributes(){return["init-date","ignore-on-focus","sunday-first","persist-on-select","show-close-icon"]}disconnectedCallback(){}attributeChangedCallback(i,t,s){"init-date"===i?this.initDate=s:"ignore-on-focus"===i?this.ignoreOnFocus=!0:"sunday-first"===i?this.sundayFirst=!0:"persist-on-select"===i?this.persistOnSelect=!0:"show-close-icon"===i&&(this.s=!0)}connectedCallback(){setTimeout(()=>{this.init()},0)}init(){if(this.u=this.querySelector("input"),null===this.u)return;var i=document.createElement("div");i.style.display="inline-block",this.D&&this.D.remove(),this.D=this.appendChild(i);const t=document.createElement("template");var s;t.innerHTML=this.o,this.D.appendChild(this.u),this.D.appendChild(t.content),this.p=this.querySelector("#calTitle"),this.m=this.querySelector("#calContainer"),this.C=new Date,null!==this.initDate?(s=this._(this.initDate)).valid?(this.C=new Date(s.g,s.N,s.k),this.l=!0,this.u.value=this.H(this.C)):"current"===this.initDate&&(this.l=!0,this.u.value=this.H(this.C)):(s=this._(this.u.value)).valid?(this.C=new Date(s.g,s.N,s.k),this.l=!0):this.l=!1,this.initDate=null,this.M=this.C.getMonth(),this.S=this.C.getFullYear(),this.m.style.display="none",this.T(),this.A(),this.P(),this.ignoreOnFocus||(this.u.onfocus=this.Y,this.u.onfocus=this.u.onfocus.bind(this)),this.u.oninput=this.j,this.u.oninput=this.u.oninput.bind(this),this.u.onblur=this.I,this.u.onblur=this.u.onblur.bind(this),this.m.onblur=this.I,this.m.onblur=this.m.onblur.bind(this),this.s||(this.querySelector("#calCtrlHideCal").style.display="none")}setFocusOnCal(){this.m&&(this.m.style.display="block",this.m.focus())}O(i){this.l=!0,this.F(i.target.innerHTML,this.M,this.S),this.u.value=this.H(this.C),this.P(),this.persistOnSelect||this.J()}J(){this.m.style.display="none",document.activeElement.blur(),this.L()}R(i){"Enter"===i.key&&this.O(i)}I(i){setTimeout(()=>{!function(i){"calContainer"===document.activeElement.id||document.activeElement.classList.contains("calCtrl")||document.activeElement.classList.contains("calDay")||document.activeElement.isSameNode(i.u)||(i.m.style.display="none",i.L(),i.l||i.dispatchEvent(new Event("invalid")))}(this)},0)}A(){for(var i=this.m.querySelectorAll(".calCtrl").entries(),t=i.next();!1===t.done;)t.value[1].tabIndex=0,t.value[1].onblur=this.I,t.value[1].onblur=t.value[1].onblur.bind(this),t.value[1].onclick=this.V,t.value[1].onclick=t.value[1].onclick.bind(this),t.value[1].onkeydown=this.V,t.value[1].onkeydown=t.value[1].onkeydown.bind(this),t.value[1].onmousedown=this.G,t.value[1].onmousedown=t.value[1].onmousedown.bind(this),t.value[1].onmouseup=this.L,t.value[1].onmouseup=t.value[1].onmouseup.bind(this),t.value[1].onmouseleave=this.L,t.value[1].onmouseleave=t.value[1].onmouseleave.bind(this),t.value[1].ontouchstart=this.G,t.value[1].ontouchstart=t.value[1].ontouchstart.bind(this),t.value[1].ontouchend=this.L,t.value[1].ontouchend=t.value[1].ontouchend.bind(this),t.value[1].ontouchcancel=this.L,t.value[1].ontouchcancel=t.value[1].ontouchcancel.bind(this),t=i.next()}K(i){this.h.push(setInterval(()=>{this.V(i)},this.t)),this.querySelector("#"+i.target.id).onclick=()=>{this.U(i,this)}}U(i,t){t.querySelector("#"+i.target.id).onclick=t.V,t.querySelector("#"+i.target.id).onclick=t.querySelector("#"+i.target.id).onclick.bind(t)}G(i){this.v.push(setTimeout(()=>{this.K(i)},this.i))}L(i){this.v.forEach(clearTimeout),this.v=[],this.h.forEach(clearInterval),this.h=[]}_(i){var t,s,a,n={},l=i.match(/^\s*(\d{1,2})\.(\d{1,2})\.(\d\d\d\d)\s*$/);return null===l?n.valid=!1:(t=Number(l[1]),s=Number(l[2]),a=Number(l[3]),this.W(t,s,a)?(n.valid=!0,n.k=t,n.N=s-1,n.g=a):n.valid=!1),n}j(){var i=this._(this.u.value);i.valid?(this.l=!0,this.F(i.k,i.N,i.g),this.M=i.N,this.S=i.g,this.P()):this.l=!1}W(i,t,s){if(t<1||t>12)return!1;var a=this.$(t,s);return!(i<1||i>a)}V(i){if("Enter"===i.key||"keydown"!==i.type)switch(i.target.id){case"calCtrlPrevYear":this.q();break;case"calCtrlNextYear":this.B();break;case"calCtrlPrevMonth":this.X();break;case"calCtrlNextMonth":this.Z();break;case"calCtrlHideCal":this.J()}}Y(){this.j(),this.m.style.display="block"}B(){this.S++,this.P()}q(){this.S--,this.P()}Z(){11===this.M?(this.M=0,this.S++):this.M++,this.P()}X(){0===this.M?(this.M=11,this.S--):this.M--,this.P()}P(){var i=new Date(this.S,this.M);i.setDate(1),this.ii(i);var t=[],s=[];this.ti(i,t,s);for(var a=this.m.querySelectorAll(".calDay").entries(),n=a.next();!1===n.done;)n.value[1].classList.remove("calAdjacentMonthDay"),n.value[1].classList.remove("calSelectedDay"),n.value[1].classList.remove("calHiddenRow"),n.value[1].classList.remove("calDayStyle"),n.value[1].onclick=null,n.value[1].onblur=null,n.value[1].onkeydown=null,s[n.value[0]]?n.value[1].classList.add("calAdjacentMonthDay"):n.value[1].classList.add("calDayStyle"),n.value[1].innerHTML=t[n.value[0]],this.M!==this.C.getMonth()||this.S!==this.C.getFullYear()||t[n.value[0]]!==this.C.getDate()||s[n.value[0]]||n.value[1].classList.add("calSelectedDay"),s[n.value[0]]?n.value[1].removeAttribute("tabindex"):(n.value[1].onclick=this.O,n.value[1].onclick=n.value[1].onclick.bind(this),n.value[1].onkeydown=this.R,n.value[1].onkeydown=n.value[1].onkeydown.bind(this),n.value[1].tabIndex=0,n.value[1].onblur=this.I,n.value[1].onblur=n.value[1].onblur.bind(this)),n=a.next();if(s.slice(35,42).every(i=>!0===i))for(n=(a=this.m.querySelectorAll(".calDay").entries()).next();!1===n.done;)n.value[0]>34&&n.value[1].classList.add("calHiddenRow"),n=a.next()}getDateString(){return this.l?this.H(this.C):null}getDateObject(){return this.l?this.C:null}F(i,t,s){i=Number(i),t=Number(t),s=Number(s),i===this.C.getDate()&&t===this.C.getMonth()&&s===this.C.getFullYear()||(this.C.setFullYear(s),this.C.setMonth(t,i),this.dispatchEvent(new CustomEvent("datechange")))}H(i){var t=i.getFullYear(),s=i.getMonth()+1;return i.getDate()+"."+s+"."+t}ii(i){var t=i.getMonth(),s=i.getFullYear();this.p.innerHTML=this.monthNames[t]+" "+s}T(){var i=[];i=this.dayNames.slice(),this.sundayFirst&&(i.pop(),i.unshift(this.dayNames[6]));for(var t=this.m.querySelectorAll(".calDayName").entries(),s=t.next();!1===s.done;)s.value[1].innerHTML=i[s.value[0]],s=t.next()}ti(i,t,s){var a,n=i.getDay(),l=i.getMonth()+1,e=i.getFullYear(),h=this.$(l,e);i.setDate(i.getDate()-1);var c=i.getMonth()+1,d=i.getFullYear(),r=this.$(c,d);if(this.sundayFirst)for(a=0;a<n;a++)t.unshift(r),r--,s.push(!0);else if(0===n)for(a=0;a<6;a++)t.unshift(r),r--,s.push(!0);else for(a=0;a<n-1;a++)t.unshift(r),r--,s.push(!0);for(a=0;a<h;a++)t.push(a+1),s.push(!1);var v=42-t.length;for(a=0;a<v;a++)t.push(a+1),s.push(!0)}si(i){return i%4==0&&i%100!=0||i%400==0}$(i,t){return 1===i||3===i||5===i||7===i||8===i||10===i||12===i?31:4===i||6===i||9===i||11===i?30:2===i&&this.si(t)?29:2!==i||this.si(t)?void 0:28}}customElements.define("text-input-datepicker",Datepicker);